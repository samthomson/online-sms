version: 2
jobs:
  build-server:
    docker:
      - image: mhart/alpine-node
    steps:
      - checkout
      - run:
          name: Build server
          command: |
            cd server
            yarn
            yarn run build
  test-server:
    docker:
      - image: mhart/alpine-node
        environment:
          - MYSQL_HOST=127.0.0.1
          - MYSQL_DATABASE=online-sms-testing
          - MYSQL_USER=root
          - MYSQL_PASSWORD=secretpassword
      - image: mysql:5.7
        environment:
          - MYSQL_ROOT_PASSWORD=secretpassword
          - MYSQL_DATABASE=online-sms-testing
    steps:
      - checkout
      - run:
          name: Test server
          command: |
            cd server
            yarn
            yarn run test
  build-client:
    docker:
      - image: mhart/alpine-node
    steps:
      - checkout
      - run:
          name: Build client
          command: |
            cd client
            yarn
            yarn run build

workflows:
  version: 2
  all:
    jobs:
      - build-server
      - test-server
      - build-client